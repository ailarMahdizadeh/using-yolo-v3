import cv2
import numpy as np 

def load_data_and_preprocess(ADRESS):
    img=cv2.imread()
    h, w=img.shape[:2]
    pre_processed_image=cv2.dnn.blobFromImage(img,scalefactor=1/255.0, size=(416,416),swapRB=True,crop=Flase)

    return img,h,w,pre_processed_image


def load_model_and_label(LABEL_ADDRESS,PARAMETERS_OF_DNN,MODEL_ADDRESS):
     labels=open(LABEL_ADDRESS).read().strip().split("\n")
     net=cv2.dnn.readNet(MODEL_ADDRESS,PARAMETERS_OF_DNN)
     
     return lables,net

def inference(pre_processed_image,net):
    net.setInput(pre_processed_image)
    output_layer=["yolo_82,"yolo_94","yolo_106"]
    predictions=net.forward(output_layer)
    return predictions

def post_processing(predictions,w,h)
    classIDs=[]
    confidences=[]
    boxes=[]
    for layer in predictions:
        for detected_object in layer:
        scores= detected_object[5:]
        classID=np.argmax(scores)
        confidence=scores(classID)
        if confidence>0.3:
           box= detected_object[0:4]*np.array([w,h,w,h])
           (conterX,conterY,width,height)=box.astype("int")
           x=int(centerX-width/2)
           y=int(centerY-height/2)

           classIDs.append(classID)
           confidences.append(float(confidence))
           boxes.append([x,y,int(width),int(height)])
return classIDs, confidences, boxes
classIDs,confidences,post_processing(predictions,w,h)


            


def show_result(img,labels,classIDs,confidences,boxes):
    colors=np.random.uniform(0,255,size=len(labels),3)
    idxs=cv2.dnn.NMSBoxes(boxes,confidence,0.3,0.5)
    for i in idxs.flatten():
        (x,y)=boxes[i][0], boxes[i][1]
        (w,h)=boxes[i][2],boxes[i][3]
        cv2.rectangle(img, (x,y),(x+w,y+h), colors[i],2)
        text="{}:{:,2f}".format(labels[classIDs[i]], confidence[i])
        cv2.putText(img, text, (x,y-10), cv2.FONT_HERSEY_SIMPLEX,0.9,colors[i],2)
    cv2.imshow("image",img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()





ADRESS="university.jpg"
LABEL_ADDRESS=r"yolo files\coco.names"
PARAMETERS_OF_DNN=r"yolo files\yolov3.cfg"
MODEL_ADDRESS=r"yolo files\yolov3.weights"
img, h, w, pre_processed_image=load_data_and_preprocess(ADRESS)
labels,net=load_model_and_label(LABEL_ADDRESS,PARAMETERS_OF_DNN,MODEL_ADDRESS)
predictions=inference(pre_processed_image,net)
post_processing(predictions,w,h)
show_result(img,labels,classIDs,confidences,boxes)